/* Minify took 0.003870964050293 */


var LatestActivity={init:function(){LatestActivity.lazyLoadContent();},lazyLoadContent:function(){$.get(wgServer+wgScript+'?action=ajax&rs=moduleProxy&moduleName=LatestActivity&actionName=Index&outputType=html',function(data){if($.browser.msie){$("section.WikiaActivityModule:not(.UserProfileRailModule_RecentActivity)").empty().append(data);}
else{$('section.WikiaActivityModule:not(.UserProfileRailModule_RecentActivity)').replaceWith(data);}});}};$(window).load(function(){LatestActivity.init();});;$(window).load(function(){if(window.ExitstitialOutboundScreen){Exitstitial.init();}});var Exitstitial={settings:{destinationURL:'',adUrl:''},init:function(){Exitstitial.attachEventListeners();},attachEventListeners:function(){var externalLinks=$('.WikiaArticle a.external.exitstitial');$(externalLinks).click(function(){Exitstitial.settings.destinationURL=$(this).attr("href");Exitstitial.settings.adUrl=ExitstitialOutboundScreen+"&u="+Exitstitial.settings.destinationURL;Exitstitial.showInfobox();return false;});},showInfobox:function(){var header=wgExitstitialTitle,body="<div id='ExitstitialInfobox'><div class='wikia-ad'></div></div>";$.showModal(header,body,{id:'ExitstitialInfoboxWrapper',width:$(window).width()-250,height:$(window).height()-250});$('#ExitstitialInfoboxWrapper').find(".close").hide();$('#ExitstitialInfoboxWrapper').prepend('<a href="'+Exitstitial.settings.destinationURL+'" class="wikia-button close-exitstitial-ad" id="skip_ad">'+wgExitstitialButton+'</a>');$('#ExitstitialInfoboxWrapper').find("h1:first").after('<p class="exitstitial-intro">'+wgExitstitialRegister+'</p>');$('.exitstitial-intro a').click(function(event){event.preventDefault();$('#ExitstitialInfoboxWrapper').closeModal();if($(this).hasClass("register")){openRegister();}else if($(this).hasClass("login")){openLogin();}});$("#ExitstitialInfobox .wikia-ad").css('visibility','visible');Exitstitial.ajaxLoadAd();},ajaxLoadAd:function(){$.get(Exitstitial.settings.adUrl,function(data){$("#ExitstitialInfobox").html(data);});}};;var UserLoginFacebook={modal:false,form:false,callbacks:{},log:function(msg){$().log(msg,'UserLoginFacebook');},init:function(){this.loginSetup();this.setupTooltips();this.log('init');},setupTooltips:function(){$.loadWikiaTooltip(function(){var buttons=$('.sso-login > a');buttons.each(function(){var button=$(this);button.wikiaTooltip(button.attr('data-tooltip'));});});},loginSetup:function(){$('body').undelegate('fb').delegate('.sso-login-facebook','click.fb',$.proxy(function(ev){ev.preventDefault();this.log('FBConnect clicked');FB.login($.proxy(this.loginCallback,this),{scope:'publish_stream,email'});},this));},loginCallback:function(response){if(typeof response==='object'&&response.status){this.log(response);switch(response.status){case'connected':this.log('FB.login successful');$.nirvana.postJson('FacebookSignupController','index',$.proxy(this.checkAccountCallback,this));break;case'unknown':break;}}},checkAccountCallback:function(resp){if(resp.loggedIn){var loginCallback=this.callbacks['login-success']||'';if(loginCallback&&typeof loginCallback==='function'){loginCallback();}else{var form=new UserLoginFacebookForm();form.reloadPage();}}
else{$.showCustomModal(resp.title,innerShiv(resp.modal),{id:'FacebookSignUp',width:710,buttons:[{id:'FacebookSignUpCancel',message:resp.cancelMsg,handler:$.proxy(function(){this.modal.closeModal();},this)}],callback:$.proxy(this.showSignupModal,this)});}},showSignupModal:function(modal){this.modal=modal;var loginCallback=this.callbacks['login-success']||'';this.form=new UserLoginFacebookForm(this.modal,{ajaxLogin:true,callback:function(res){if(loginCallback&&typeof loginCallback==='function'){loginCallback();}else if(res.location){window.location.href=res.location;}}});this.wikiaForm=this.form.wikiaForm;this.modal.find('.FacebookSignupConfigHeader').bind('click',function(ev){ev.preventDefault();$(this).toggleClass('on').next('form').toggle();});this.signupAjaxForm=new UserSignupAjaxForm(this.wikiaForm,['username','password'],this.form.el.find('input[type=submit]'));this.wikiaForm.el.find('input[name=username], input[name=password]').bind('blur.UserLoginFacebook',$.proxy(this.signupAjaxForm.validateInput,this.signupAjaxForm));$.getResources([$.getSassCommonURL('extensions/wikia/UserLogin/css/UserLoginFacebook.scss')]);},closeSignupModal:function(){if(this.modal){this.modal.closeModal();}}};$(function(){UserLoginFacebook.init();});;var UserLoginFacebookForm=$.createClass(UserLoginAjaxForm,{init:function(){UserLoginFacebookForm.superclass.init.call(this);var feedForm=this.form.parent().children('.FacebookSignupConfig');this.feedCheckboxes=feedForm.find('input[type="checkbox"]');},getFeedOptions:function(){var ret=[],feedName,feedOptions=this.feedCheckboxes.serializeArray();for(var i=0,len=feedOptions.length;i<len;i++){feedName=feedOptions[i].name.split('-').pop();ret.push(feedName);}
return ret;},retrieveLoginToken:function(){},ajaxLogin:function(){$.nirvana.postJson('FacebookSignupController','signup',{username:this.inputs.username.val(),password:this.inputs.password.val(),signupToken:this.inputs.logintoken.val(),fbfeedoptions:this.getFeedOptions().join(',')},$.proxy(this.submitLoginHandler,this));}});;